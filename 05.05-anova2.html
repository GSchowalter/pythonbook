

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>17. Factorial ANOVA &#8212; Learning Statistics with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '05.05-anova2';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="18. Bayesian Statistics" href="06.01-bayes.html" />
    <link rel="prev" title="16. Linear regression" href="05.04-regression.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="landingpage.html">
  
  
  
  
  
    <p class="title logo__title">Learning Statistics with Python</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="landingpage.html">
                    Learning Statistics with Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Part I. Background</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="01.01-intro.html">1. Why do we learn statistics?</a></li>
<li class="toctree-l1"><a class="reference internal" href="01.02-studydesign.html">2. A brief introduction to research design</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part II. An Introduction to Python</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="02.01-getting_started_with_python.html">3. Getting Started with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="02.02-more_python_concepts.html">4. More Python Concepts</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part III. Working With Data</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="03.01-descriptives.html">5. Descriptive statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="03.02-drawing_graphs.html">6. Drawing Graphs</a></li>
<li class="toctree-l1"><a class="reference internal" href="03.03-pragmatic_matters.html">7. Data Wrangling</a></li>
<li class="toctree-l1"><a class="reference internal" href="03.04-basic_programming.html">8. Basic Programming</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part IV. Statistical Theory</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="04.01-intro-to-probability.html">9. Statistical theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="04.02-probability.html">10. Introduction to Probability</a></li>
<li class="toctree-l1"><a class="reference internal" href="04.03-estimation.html">11. Estimating unknown quantities from a sample</a></li>
<li class="toctree-l1"><a class="reference internal" href="04.04-hypothesis-testing.html">12. Hypothesis Testing</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part V. Statistical Tools</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="05.01-chisquare.html">13. Categorical data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="05.02-ttest.html">14. Comparing Two Means</a></li>
<li class="toctree-l1"><a class="reference internal" href="05.03-anova.html">15. Comparing several means (one-way ANOVA)</a></li>
<li class="toctree-l1"><a class="reference internal" href="05.04-regression.html">16. Linear regression</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">17. Factorial ANOVA</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Part VI. Endings, Alternatives and Prospects</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="06.01-bayes.html">18. Bayesian Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="06.02-epilogue.html">19. Epilogue</a></li>
<li class="toctree-l1"><a class="reference internal" href="bibliography.html">20. References</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/ethanweed/pythonbook" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/ethanweed/pythonbook/issues/new?title=Issue%20on%20page%20%2F05.05-anova2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/05.05-anova2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Factorial ANOVA</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factorial-anova-1-balanced-designs-no-interactions">17.1. Factorial ANOVA 1: balanced designs, no interactions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-hypotheses-are-we-testing">17.1.1. What hypotheses are we testing?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-analysis-in-python">17.1.2. Running the analysis in Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-our-degrees-of-freedom">17.1.3. What are our degrees of freedom?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#factorial-anova-versus-one-way-anovas">17.1.4. Factorial ANOVA versus one-way ANOVAs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-kinds-of-outcomes-does-this-analysis-capture">17.1.5. What kinds of outcomes does this analysis capture?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factorial-anova-2-balanced-designs-interactions-allowed">17.2. Factorial ANOVA 2: balanced designs, interactions allowed</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-exactly-is-an-interaction-effect">17.2.1. What exactly <em>is</em> an interaction effect?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-sums-of-squares-for-the-interaction">17.2.2. Calculating sums of squares for the interaction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#degrees-of-freedom-for-the-interaction">17.2.3. Degrees of freedom for the interaction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-results">17.2.4. Interpreting the results</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="factorial-anova">
<span id="anova2"></span><h1><span class="section-number">17. </span>Factorial ANOVA<a class="headerlink" href="#factorial-anova" title="Permalink to this heading">#</a></h1>
<p>Over the course of the last few chapters you can probably detect a general trend. We started out looking at tools that you can use to compare two groups to one another, most notably the <a class="reference internal" href="05.02-ttest.html#ttest"><span class="std std-ref"><span class="math notranslate nohighlight">\(t\)</span>-test</span></a>. Then, we introduced <a class="reference internal" href="05.03-anova.html#anova"><span class="std std-ref">analysis of variance</span></a> (ANOVA) as a method for comparing more than two groups. The chapter on <a class="reference internal" href="05.04-regression.html#regression"><span class="std std-ref">regression</span></a> covered a somewhat different topic, but in doing so it introduced a powerful new idea: building statistical models that have <em>multiple</em> predictor variables used to explain a single outcome variable. For instance, a regression model could be used to predict the number of errors a student makes in a reading comprehension test based on the number of hours they studied for the test, and their score on a standardised IQ test. The goal in this chapter is to import this idea into the ANOVA framework. For instance, suppose we were interested in using the reading comprehension test to measure student achievements in three different schools, and we suspect that girls and boys are developing at different rates (and so would be expected to have different performance on average). Each student is classified in two different ways: on the basis of their gender, and on the basis of their school. What we’d like to do is analyse the reading comprehension scores in terms of <em>both</em> of these grouping variables. The tool for doing so is generically referred to as <strong><em>factorial ANOVA</em></strong>. However, since we have two grouping variables, we sometimes refer to the analysis as a two-way ANOVA, in contrast to the one-way ANOVAs that we <a class="reference internal" href="05.03-anova.html#anova"><span class="std std-ref">ran earlier</span></a>.</p>
<section id="factorial-anova-1-balanced-designs-no-interactions">
<span id="factorialanovasimple"></span><h2><span class="section-number">17.1. </span>Factorial ANOVA 1: balanced designs, no interactions<a class="headerlink" href="#factorial-anova-1-balanced-designs-no-interactions" title="Permalink to this heading">#</a></h2>
<p>When we discussed <a class="reference internal" href="05.03-anova.html#anova"><span class="std std-ref">analysis of variance</span></a>, we assumed a fairly simple experimental design: each person falls into one of several groups, and we want to know whether these groups have different means on some outcome variable. In this section, I’ll discuss a broader class of experimental designs, known as <strong><em>factorial designs</em></strong>, in we have more than one grouping variable. I gave one example of how this kind of design might arise above. Another example appears in the chapter on <a class="reference internal" href="05.03-anova.html#anova"><span class="std std-ref">ANOVA</span></a>, in which we were looking at the effect of different drugs on the <code class="docutils literal notranslate"><span class="pre">mood_gain</span></code> experienced by each person. In that chapter we did find a significant effect of drug, but at the end of the chapter we also ran an analysis to see if there was an effect of therapy. We didn’t find one, but there’s something a bit worrying about trying to run two <em>separate</em> analyses trying to predict the same outcome. Maybe there actually <em>is</em> an effect of therapy on mood gain, but we couldn’t find it because it was being “hidden” by the effect of drug? In other words, we’re going to want to run a <em>single</em> analysis that includes <em>both</em> <code class="docutils literal notranslate"><span class="pre">drug</span></code> and <code class="docutils literal notranslate"><span class="pre">therapy</span></code> as predictors. For this analysis each person is cross-classified by the drug they were given (a factor with 3 levels) and what therapy they received (a factor with 2 levels). We refer to this as a <span class="math notranslate nohighlight">\(3 \times 2\)</span> factorial design. If we cross-tabulate <code class="docutils literal notranslate"><span class="pre">drug</span></code> by <code class="docutils literal notranslate"><span class="pre">therapy</span></code> using the <code class="docutils literal notranslate"><span class="pre">crosstab()</span></code> in <code class="docutils literal notranslate"><span class="pre">pandas</span></code>, we get the following table:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/ethanweed/pythonbook/main/Data/clintrial.csv&quot;</span><span class="p">)</span>

<span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;drug&quot;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;therapy&quot;</span><span class="p">],</span><span class="n">margins</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>therapy</th>
      <th>CBT</th>
      <th>no.therapy</th>
    </tr>
    <tr>
      <th>drug</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>anxifree</th>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>joyzepam</th>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>placebo</th>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>As you can see, not only do we have participants corresponding to all possible combinations of the two factors, indicating that our design is <strong><em>completely crossed</em></strong>, it turns out that there are an equal number of people in each group. In other words, we have a <strong><em>balanced</em></strong> design. In this section I’ll talk about how to analyse data from balanced designs, since this is the simplest case. The story for unbalanced designs is quite tedious, so we’ll put it to one side for the moment.</p>
<section id="what-hypotheses-are-we-testing">
<span id="factanovahyp"></span><h3><span class="section-number">17.1.1. </span>What hypotheses are we testing?<a class="headerlink" href="#what-hypotheses-are-we-testing" title="Permalink to this heading">#</a></h3>
<p>Like one-way ANOVA, factorial ANOVA is a tool for testing certain types of hypotheses about population means. So a sensible place to start would be to be explicit about what our hypotheses actually are. However, before we can even get to that point, it’s really useful to have some clean and simple notation to describe the population means. Because of the fact that observations are cross-classified in terms of two different factors, there are quite a lot of different means that one might be interested. To see this, let’s start by thinking about all the different sample means that we can calculate for this kind of design. Firstly, there’s the obvious idea that we might be interested in this table of group means:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;therapy&#39;</span><span class="p">,</span> <span class="s1">&#39;drug&#39;</span><span class="p">])[</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>therapy</th>
      <th>drug</th>
      <th>mood_gain</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CBT</td>
      <td>anxifree</td>
      <td>1.03</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CBT</td>
      <td>joyzepam</td>
      <td>1.50</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CBT</td>
      <td>placebo</td>
      <td>0.60</td>
    </tr>
    <tr>
      <th>3</th>
      <td>no.therapy</td>
      <td>anxifree</td>
      <td>0.40</td>
    </tr>
    <tr>
      <th>4</th>
      <td>no.therapy</td>
      <td>joyzepam</td>
      <td>1.47</td>
    </tr>
    <tr>
      <th>5</th>
      <td>no.therapy</td>
      <td>placebo</td>
      <td>0.30</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now, this output shows a cross-tabulation of the group means for all possible combinations of the two factors (e.g., people who received the placebo and no therapy, people who received the placebo while getting CBT, etc). However, we can also construct tables that ignore one of the two factors. That gives us output that looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;therapy&#39;</span><span class="p">])[</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>therapy</th>
      <th>mood_gain</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CBT</td>
      <td>1.04</td>
    </tr>
    <tr>
      <th>1</th>
      <td>no.therapy</td>
      <td>0.72</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;drug&#39;</span><span class="p">])[</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>drug</th>
      <th>mood_gain</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>anxifree</td>
      <td>0.72</td>
    </tr>
    <tr>
      <th>1</th>
      <td>joyzepam</td>
      <td>1.48</td>
    </tr>
    <tr>
      <th>2</th>
      <td>placebo</td>
      <td>0.45</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>But of course, if we can ignore one factor we can certainly ignore both. That is, we might also be interested in calculating the average  mood gain across all 18 participants, regardless of what drug or psychological therapy they were given:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">round</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.88
</pre></div>
</div>
</div>
</div>
<p>At this point we have 12 different sample means to keep track of! It is helpful to organise all these numbers into a single table, which would look like this:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-left"><p>no therapy</p></th>
<th class="head text-left"><p>CBT</p></th>
<th class="head text-left"><p>total</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>placebo</p></td>
<td class="text-left"><p>0.30</p></td>
<td class="text-left"><p>0.60</p></td>
<td class="text-left"><p>0.45</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>anxifree</p></td>
<td class="text-left"><p>0.40</p></td>
<td class="text-left"><p>1.03</p></td>
<td class="text-left"><p>0.72</p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>joyzepam</p></td>
<td class="text-left"><p>1.47</p></td>
<td class="text-left"><p>1.50</p></td>
<td class="text-left"><p>1.48</p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>total</p></td>
<td class="text-left"><p>0.72</p></td>
<td class="text-left"><p>1.04</p></td>
<td class="text-left"><p>0.88</p></td>
</tr>
</tbody>
</table>
<p>Now, each of these different means is of course a sample statistic: it’s a quantity that pertains to the specific observations that we’ve made during our study. What we want to make inferences about are the corresponding population parameters: that is, the true means as they exist within some broader population. Those population means can also be organised into a similar table, but we’ll need a little mathematical notation to do so. As usual, I’ll use the symbol <span class="math notranslate nohighlight">\(\mu\)</span> to denote a population mean. However, because there are lots of different means, I’ll need to use subscripts to distinguish between them.</p>
<p>Here’s how the notation works. Our table is defined in terms of two factors: each row corresponds to a different level of Factor A (in this case <code class="docutils literal notranslate"><span class="pre">drug</span></code>), and each column corresponds to a different level of Factor B (in this case <code class="docutils literal notranslate"><span class="pre">therapy</span></code>). If we let <span class="math notranslate nohighlight">\(R\)</span> denote the number of rows in the table, and <span class="math notranslate nohighlight">\(C\)</span> denote the number of columns, we can refer to this as an <span class="math notranslate nohighlight">\(R \times C\)</span> factorial ANOVA. In this case <span class="math notranslate nohighlight">\(R=3\)</span> and <span class="math notranslate nohighlight">\(C=2\)</span>. We’ll use lowercase letters to refer to specific rows and columns, so <span class="math notranslate nohighlight">\(\mu_{rc}\)</span> refers to the population mean associated with the <span class="math notranslate nohighlight">\(r\)</span>th level of Factor A (i.e. row number <span class="math notranslate nohighlight">\(r\)</span>) and the <span class="math notranslate nohighlight">\(c\)</span>th level of Factor B (column number <span class="math notranslate nohighlight">\(c\)</span>).<a class="footnote-reference brackets" href="#notesubscript" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a> So the population means are now written like this:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-left"><p>no therapy</p></th>
<th class="head text-left"><p>CBT</p></th>
<th class="head text-left"><p>total</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>placebo</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{11}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{12}\)</span></p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>anxifree</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{21}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{22}\)</span></p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>joyzepam</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{31}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{32}\)</span></p></td>
<td class="text-left"><p></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>total</p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
<td class="text-left"><p></p></td>
</tr>
</tbody>
</table>
<p>Okay, what about the remaining entries? For instance, how should we describe the average mood gain across the entire (hypothetical) population of people who might be given Joyzepam in an experiment like this, regardless of whether they were in CBT? We use the “dot” notation to express this. In the case of Joyzepam, notice that we’re talking about the mean associated with the third row in the table. That is, we’re averaging across two cell means (i.e., <span class="math notranslate nohighlight">\(\mu_{31}\)</span> and <span class="math notranslate nohighlight">\(\mu_{32}\)</span>). The result of this averaging is referred to as a <strong><em>marginal mean</em></strong>, and would be denoted <span class="math notranslate nohighlight">\(\mu_{3.}\)</span> in this case. The marginal mean for CBT corresponds to the population mean associated with the second column in the table, so we use the notation <span class="math notranslate nohighlight">\(\mu_{.2}\)</span> to describe it. The grand mean is denoted <span class="math notranslate nohighlight">\(\mu_{..}\)</span> because it is the mean obtained by averaging (marginalising<a class="footnote-reference brackets" href="#notemarginalising" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>) over both. So our full table of population means can be written down like this:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-left"><p>no therapy</p></th>
<th class="head text-left"><p>CBT</p></th>
<th class="head text-left"><p>total</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>placebo</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{11}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{12}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{1.}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>anxifree</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{21}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{22}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{2.}\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>joyzepam</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{31}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{32}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{3.}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>total</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{.1}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{.2}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\mu_{..}\)</span></p></td>
</tr>
</tbody>
</table>
<p>Now that we have this notation, it is straightforward to formulate and express some hypotheses. Let’s suppose that the goal is to find out two things: firstly, does the choice of drug have any effect on mood, and secondly, does CBT have any effect on mood? These aren’t the only hypotheses that we could formulate of course, and we’ll see a really important example of a different kind of hypothesis in the section on <a class="reference internal" href="#interactions"><span class="std std-ref">interactions</span></a>, but these are the two simplest hypotheses to test, and so we’ll start there. Consider the first test. If drug has no effect, then we would expect all of the row means to be identical, right? So that’s our null hypothesis. On the other hand, if the drug does matter then we should expect these row means to be different. Formally, we write down our null and alternative hypotheses in terms of the <em>equality of marginal means</em>:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-left"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span>:</p></td>
<td class="text-left"><p>row means are the same i.e. <span class="math notranslate nohighlight">\(\mu_{1.} = \mu_{2.} = \mu_{3.}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Alternative hypothesis <span class="math notranslate nohighlight">\(H_1\)</span>:</p></td>
<td class="text-left"><p>at least one row mean is different.</p></td>
</tr>
</tbody>
</table>
<p>It’s worth noting that these are <em>exactly</em> the same statistical hypotheses that we formed when we ran a one-way ANOVA on these data <a class="reference internal" href="05.03-anova.html#anova"><span class="std std-ref">way back when</span></a>. Back then I used the notation <span class="math notranslate nohighlight">\(\mu_P\)</span> to refer to the mean mood gain for the placebo group, with <span class="math notranslate nohighlight">\(\mu_A\)</span> and <span class="math notranslate nohighlight">\(\mu_J\)</span> corresponding to the group means for the two drugs, and the null hypothesis was <span class="math notranslate nohighlight">\(\mu_P = \mu_A = \mu_J\)</span>. So we’re actually talking about the same hypothesis: it’s just that the more complicated ANOVA requires more careful notation due to the presence of multiple grouping variables, so we’re now referring to this hypothesis as <span class="math notranslate nohighlight">\(\mu_{1.} = \mu_{2.} = \mu_{3.}\)</span>. However, as we’ll see shortly, although the hypothesis is identical, the test of that hypothesis is subtly different due to the fact that we’re now acknowledging the existence of the second grouping variable.</p>
<p>Speaking of the other grouping variable, you won’t be surprised to discover that our second hypothesis test is formulated the same way. However, since we’re talking about the psychological therapy rather than drugs, our null hypothesis now corresponds to the equality of the column means:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-left"><p></p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>Null hypothesis <span class="math notranslate nohighlight">\(H_0\)</span>:</p></td>
<td class="text-left"><p>column means are the same, i.e., <span class="math notranslate nohighlight">\(\mu_{.1} = \mu_{.2}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>Alternative hypothesis <span class="math notranslate nohighlight">\(H_1\)</span>:</p></td>
<td class="text-left"><p>column means are different, i.e., <span class="math notranslate nohighlight">\(\mu_{.1} \neq \mu_{.2}\)</span></p></td>
</tr>
</tbody>
</table>
</section>
<section id="running-the-analysis-in-python">
<h3><span class="section-number">17.1.2. </span>Running the analysis in Python<a class="headerlink" href="#running-the-analysis-in-python" title="Permalink to this heading">#</a></h3>
<p>If the data you’re trying to analyse correspond to a balanced factorial design, then running your analysis of variance is easy. To see how easy it is, let’s start by reproducing the original analysis from <a class="reference internal" href="05.03-anova.html#anova"><span class="std std-ref">earlier</span></a>. In case you’ve forgotten, for that analysis we were using only a single factor (i.e., <code class="docutils literal notranslate"><span class="pre">drug</span></code>) as our between-subjects variable to predict our outcome (dependent) variable (i.e., <code class="docutils literal notranslate"><span class="pre">mood_gain</span></code>), and so this was what we did:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pingouin</span> <span class="k">as</span> <span class="nn">pg</span>

<span class="n">model1</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span><span class="n">dv</span><span class="o">=</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">,</span> <span class="n">between</span><span class="o">=</span><span class="s1">&#39;drug&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">round</span><span class="p">(</span><span class="n">model1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>SS</th>
      <th>DF</th>
      <th>MS</th>
      <th>F</th>
      <th>p-unc</th>
      <th>np2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>drug</td>
      <td>3.45</td>
      <td>2</td>
      <td>1.73</td>
      <td>18.61</td>
      <td>0.0</td>
      <td>0.71</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Within</td>
      <td>1.39</td>
      <td>15</td>
      <td>0.09</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Note that this time around I’ve used the name <code class="docutils literal notranslate"><span class="pre">model1</span></code> as the label for my <code class="docutils literal notranslate"><span class="pre">aov</span></code> object, since I’m planning on creating quite a few other models too. To start with, suppose I’m also curious to find out if <code class="docutils literal notranslate"><span class="pre">therapy</span></code> has a relationship to <code class="docutils literal notranslate"><span class="pre">mood_gain</span></code>. In light of what we’ve seen from our discussion of <a class="reference internal" href="05.04-regression.html#regression"><span class="std std-ref">multiple regression</span></a>, you probably won’t be surprised that all we have to do is extend the formula: in other words, if we specify <code class="docutils literal notranslate"><span class="pre">dv=mood.gain,</span> <span class="pre">between=['drug',</span> <span class="pre">'therapy']</span></code> as our model, we’ll probably get what we’re after:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model2</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span><span class="n">dv</span><span class="o">=</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">,</span> <span class="n">between</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">,</span> <span class="s1">&#39;therapy&#39;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">round</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>SS</th>
      <th>DF</th>
      <th>MS</th>
      <th>F</th>
      <th>p-unc</th>
      <th>np2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>drug</td>
      <td>3.4533</td>
      <td>2</td>
      <td>1.7267</td>
      <td>31.7143</td>
      <td>0.0000</td>
      <td>0.8409</td>
    </tr>
    <tr>
      <th>1</th>
      <td>therapy</td>
      <td>0.4672</td>
      <td>1</td>
      <td>0.4672</td>
      <td>8.5816</td>
      <td>0.0126</td>
      <td>0.4170</td>
    </tr>
    <tr>
      <th>2</th>
      <td>drug * therapy</td>
      <td>0.2711</td>
      <td>2</td>
      <td>0.1356</td>
      <td>2.4898</td>
      <td>0.1246</td>
      <td>0.2933</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Residual</td>
      <td>0.6533</td>
      <td>12</td>
      <td>0.0544</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Most of this output is pretty simple to read too: the first row of the table reports a between-group sum of squares (SS) value associated with the <code class="docutils literal notranslate"><span class="pre">drug</span></code> factor, along with a corresponding between-group <span class="math notranslate nohighlight">\(df\)</span> value. It also calculates a mean square value (MS), and <span class="math notranslate nohighlight">\(F\)</span>-statistic, an (uncorrected) <span class="math notranslate nohighlight">\(p\)</span>-value, and an estimate of the effect size (<code class="docutils literal notranslate"><span class="pre">np2</span></code>, that is, partial eta-squared). There is also a row corresponding to the <code class="docutils literal notranslate"><span class="pre">therapy</span></code> factor, and a row corresponding to the residuals (i.e., the within groups variation).</p>
<p>Now, the third row is a little trickier, so let’s just save that one for <a class="reference internal" href="#interactions"><span class="std std-ref">later</span></a>, shall we? (Spoiler: this is the interaction of <code class="docutils literal notranslate"><span class="pre">drug</span></code> and <code class="docutils literal notranslate"><span class="pre">therapy</span></code>, but we’ll get there soon).</p>
<p>Not only are all of the individual quantities pretty familiar, the relationships between these different quantities has remained unchanged: just like we saw with the original one-way ANOVA, note that the mean square value is calculated by dividing SS by the corresponding <span class="math notranslate nohighlight">\(df\)</span>. That is, it’s still true that</p>
<div class="math notranslate nohighlight">
\[
\mbox{MS} = \frac{\mbox{SS}}{df}
\]</div>
<p>regardless of whether we’re talking about <code class="docutils literal notranslate"><span class="pre">drug</span></code>, <code class="docutils literal notranslate"><span class="pre">therapy</span></code> or the residuals. To see this, let’s not worry about how the sums of squares values are calculated: instead, let’s take it on faith that Python has calculated the SS values correctly, and try to verify that all the rest of the numbers make sense. First, note that for the <code class="docutils literal notranslate"><span class="pre">drug</span></code> factor, we divide <span class="math notranslate nohighlight">\(3.45\)</span> by <span class="math notranslate nohighlight">\(2\)</span>, and end up with a mean square value of <span class="math notranslate nohighlight">\(1.73\)</span>. For the <code class="docutils literal notranslate"><span class="pre">therapy</span></code> factor, there’s only 1 degree of freedom, so our calculations are even simpler: dividing <span class="math notranslate nohighlight">\(0.47\)</span> (the SS value) by 1 gives us an answer of <span class="math notranslate nohighlight">\(0.47\)</span> (the MS value).</p>
<p>Turning to the <span class="math notranslate nohighlight">\(F\)</span> statistics and the <span class="math notranslate nohighlight">\(p\)</span> values, notice that we have two of each: one corresponding to the <code class="docutils literal notranslate"><span class="pre">drug</span></code> factor and the other corresponding to the <code class="docutils literal notranslate"><span class="pre">therapy</span></code> factor. Regardless of which one we’re talking about, the <span class="math notranslate nohighlight">\(F\)</span> statistic is calculated by dividing the mean square value associated with the factor by the mean square value associated with the residuals. If we use “A” as shorthand notation to refer to the first factor (factor A; in this case <code class="docutils literal notranslate"><span class="pre">drug</span></code>) and “R” as shorthand notation to refer to the residuals, then the <span class="math notranslate nohighlight">\(F\)</span> statistic associated with factor A is denoted <span class="math notranslate nohighlight">\(F_A\)</span>, and is calculated as follows:</p>
<div class="math notranslate nohighlight">
\[
F_{A} = \frac{\mbox{MS}_{A}}{\mbox{MS}_{R}}
\]</div>
<p>Note that this use of “R” to refer to residuals is a bit awkward, since we also used the letter R to refer to the number of rows in the table, but I’m only going to use “R” to mean residuals in the context of SS<span class="math notranslate nohighlight">\(_R\)</span> and MS<span class="math notranslate nohighlight">\(_R\)</span>, so hopefully this shouldn’t be confusing. Anyway, to apply this formula to the  <code class="docutils literal notranslate"><span class="pre">drugs</span></code> factor, we take the mean square of <span class="math notranslate nohighlight">\(1.73\)</span> and divide it by the residual mean square value of <span class="math notranslate nohighlight">\(0.07\)</span>, which gives us an <span class="math notranslate nohighlight">\(F\)</span>-statistic of <span class="math notranslate nohighlight">\(26.15\)</span>. The corresponding calculation for the <code class="docutils literal notranslate"><span class="pre">therapy</span></code> variable would be to divide <span class="math notranslate nohighlight">\(0.47\)</span> by <span class="math notranslate nohighlight">\(0.07\)</span> which gives <span class="math notranslate nohighlight">\(7.08\)</span> as the <span class="math notranslate nohighlight">\(F\)</span>-statistic. Not surprisingly, of course, these are the same values that R has reported in the ANOVA table above.</p>
<p>The last part of the ANOVA table is the calculation of the <span class="math notranslate nohighlight">\(p\)</span> values. Once again, there is nothing new here: for each of our two factors, what we’re trying to do is test the null hypothesis that there is no relationship between the factor and the outcome variable (I’ll be a bit more precise about this later on). To that end, we’ve (apparently) followed a similar strategy that we did in the one way ANOVA, and have calculated an <span class="math notranslate nohighlight">\(F\)</span>-statistic for each of these hypotheses. To convert these to <span class="math notranslate nohighlight">\(p\)</span> values, all we need to do is note that the  that the sampling distribution for the <span class="math notranslate nohighlight">\(F\)</span> <em>statistic</em> under the null hypothesis (that the factor in question is irrelevant) is an <span class="math notranslate nohighlight">\(F\)</span> <em>distribution</em>: and that two degrees of freedom values are those corresponding to the factor, and those corresponding to the residuals. For the <code class="docutils literal notranslate"><span class="pre">drug</span></code> factor we’re talking about an <span class="math notranslate nohighlight">\(F\)</span> distribution with 2 and 14 degrees of freedom (I’ll discuss degrees of freedom in more detail later). In contrast, for the <code class="docutils literal notranslate"><span class="pre">therapy</span></code> factor sampling distribution is <span class="math notranslate nohighlight">\(F\)</span> with 1 and 14 degrees of freedom.</p>
<p>At this point, I hope you can see that the ANOVA table for this more complicated analysis corresponding to <code class="docutils literal notranslate"><span class="pre">model2</span></code> should be read in much the same way as the ANOVA table for the simpler analysis for <code class="docutils literal notranslate"><span class="pre">model1</span></code>. In short, it’s telling us that the factorial ANOVA for our <span class="math notranslate nohighlight">\(3 \times 2\)</span> design found a significant effect of drug (<span class="math notranslate nohighlight">\(F_{2,12} = 31.71, p &lt; .001\)</span>) as well as a significant effect of therapy (<span class="math notranslate nohighlight">\(F_{1,12} = 8.58, p = .01\)</span>). Or, to use the more technically correct terminology, we would say that there are two <strong><em>main effects</em></strong> of drug and therapy. Why are these “main” effects? Well, because there could also be an <em>interaction</em> between the effect of <code class="docutils literal notranslate"><span class="pre">drug</span></code> and the effect of <code class="docutils literal notranslate"><span class="pre">therapy</span></code>. We’ll explore the concept of <a class="reference internal" href="#interactions"><span class="std std-ref">interactions</span></a> below.</p>
<p>In the previous section I had two goals: firstly, to show you that the Python commands needed to do factorial ANOVA are pretty much the same ones that we used for a one way ANOVA. The only difference is that we add to the number of predictors in the <code class="docutils literal notranslate"><span class="pre">between</span></code> argument of <code class="docutils literal notranslate"><span class="pre">pingouin</span></code>’s <code class="docutils literal notranslate"><span class="pre">anova()</span></code> function. Secondly, I wanted to show you what the ANOVA table looks like in this case, so that you can see from the outset that the basic logic and structure behind factorial ANOVA is the same as that which underpins one way ANOVA. Try to hold onto that feeling. It’s genuinely true, insofar as factorial ANOVA is built in more or less the same way as the simpler one-way ANOVA model. It’s just that this feeling of familiarity starts to evaporate once you start digging into the details. Traditionally, this comforting sensation is replaced by an urge to murder the the authors of statistics textbooks.</p>
<p>Okay, let’s start looking at some of those details. The explanation that I gave in the last section illustrates the fact that the hypothesis tests for the main effects (of drug and therapy in this case) are <span class="math notranslate nohighlight">\(F\)</span>-tests, but what it doesn’t do is show you how the sum of squares (SS) values are calculated. Nor does it tell you explicitly how to calculate degrees of freedom (<span class="math notranslate nohighlight">\(df\)</span> values) though that’s a simple thing by comparison. Let’s assume for now that we have only two predictor variables, Factor A and Factor B. If we use <span class="math notranslate nohighlight">\(Y\)</span> to refer to the outcome variable, then we would use <span class="math notranslate nohighlight">\(Y_{rci}\)</span> to refer to the outcome associated with the <span class="math notranslate nohighlight">\(i\)</span>-th member of group <span class="math notranslate nohighlight">\(rc\)</span> (i.e., level/row <span class="math notranslate nohighlight">\(r\)</span> for Factor A and level/column <span class="math notranslate nohighlight">\(c\)</span> for Factor B). Thus, if we use <span class="math notranslate nohighlight">\(\bar{Y}\)</span> to refer to a sample mean, we can use the same notation as before to refer to group means, marginal means and grand means: that is, <span class="math notranslate nohighlight">\(\bar{Y}_{rc}\)</span> is the sample mean associated with the <span class="math notranslate nohighlight">\(r\)</span>th level of Factor A and the <span class="math notranslate nohighlight">\(c\)</span>th level of Factor B, <span class="math notranslate nohighlight">\(\bar{Y}_{r.}\)</span> would be the marginal mean for the <span class="math notranslate nohighlight">\(r\)</span>th level of Factor A, <span class="math notranslate nohighlight">\(\bar{Y}_{.c}\)</span> would be the marginal mean for the <span class="math notranslate nohighlight">\(c\)</span>th level of Factor B, and <span class="math notranslate nohighlight">\(\bar{Y}_{..}\)</span> is the grand mean. In other words, our sample means can be organised into the same table as the population means. For our clinical trial data, that table looks like this:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head text-left"><p></p></th>
<th class="head text-left"><p>no therapy</p></th>
<th class="head text-left"><p>CBT</p></th>
<th class="head text-left"><p>total</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td class="text-left"><p>placebo</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{11}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{12}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{1.}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>anxifree</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{21}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{22}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{2.}\)</span></p></td>
</tr>
<tr class="row-even"><td class="text-left"><p>joyzepam</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{31}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{32}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{3.}\)</span></p></td>
</tr>
<tr class="row-odd"><td class="text-left"><p>total</p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{.1}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{.2}\)</span></p></td>
<td class="text-left"><p><span class="math notranslate nohighlight">\(\bar{Y}_{..}\)</span></p></td>
</tr>
</tbody>
</table>
<p>And if we look at the sample means that I showed earlier, we have <span class="math notranslate nohighlight">\(\bar{Y}_{11} = 0.30\)</span>, <span class="math notranslate nohighlight">\(\bar{Y}_{12} = 0.60\)</span> etc. In our clinical trial example, the <code class="docutils literal notranslate"><span class="pre">drugs</span></code> factor has 3 levels and the <code class="docutils literal notranslate"><span class="pre">therapy</span></code> factor has 2 levels, and so what we’re trying to run is a <span class="math notranslate nohighlight">\(3 \times 2\)</span> factorial ANOVA. However, we’ll be a little more general and say that Factor A (the row factor) has <span class="math notranslate nohighlight">\(R\)</span> levels and Factor B (the column factor) has <span class="math notranslate nohighlight">\(C\)</span> levels, and so what we’re runnning here is an <span class="math notranslate nohighlight">\(R \times C\)</span> factorial ANOVA.</p>
<p>Now that we’ve got our notation straight, we can compute the sum of squares values for each of the two factors in a relatively familiar way. For Factor A, our between group sum of squares is calculated by assessing the extent to which the (row) marginal means <span class="math notranslate nohighlight">\(\bar{Y}_{1.}\)</span>, <span class="math notranslate nohighlight">\(\bar{Y}_{2.}\)</span> etc, are different from the grand mean <span class="math notranslate nohighlight">\(\bar{Y}_{..}\)</span>. We do this in the same way that we did for one-way ANOVA: calculate the sum of squared difference between the <span class="math notranslate nohighlight">\(\bar{Y}_{i.}\)</span> values and the <span class="math notranslate nohighlight">\(\bar{Y}_{..}\)</span> values. Specifically, if there are <span class="math notranslate nohighlight">\(N\)</span> people in each group, then we calculate this:</p>
<div class="math notranslate nohighlight">
\[
\mbox{SS}_{A} = (N \times C)  \sum_{r=1}^R  \left( \bar{Y}_{r.} - \bar{Y}_{..} \right)^2
\]</div>
<p>As with one-way ANOVA, the most interesting <a class="footnote-reference brackets" href="#translation" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a> part of this formula is the <span class="math notranslate nohighlight">\(\left( \bar{Y}_{r.} - \bar{Y}_{..} \right)^2\)</span> bit, which corresponds to the squared deviation associated with level <span class="math notranslate nohighlight">\(r\)</span>. All that this formula does is calculate this squared deviation for all <span class="math notranslate nohighlight">\(R\)</span> levels of the factor, add them up, and then multiply the result by <span class="math notranslate nohighlight">\(N \times C\)</span>. The reason for this last part is that there are multiple cells in our design that have level <span class="math notranslate nohighlight">\(r\)</span> on Factor A: in fact, there are <span class="math notranslate nohighlight">\(C\)</span> of them, one corresponding to each possible level of Factor B! For instance, in our toy example, there are <em>two</em> different cells in the design corresponding to the <code class="docutils literal notranslate"><span class="pre">anxifree</span></code> drug: one for people with <code class="docutils literal notranslate"><span class="pre">no.therapy</span></code>, and one for the <code class="docutils literal notranslate"><span class="pre">CBT</span></code> group. Not only that, within each of these cells there are <span class="math notranslate nohighlight">\(N\)</span> observations. So, if we want to convert our SS value into a quantity that calculates the between-groups sum of squares on a “per observation” basis, we have to multiply by by <span class="math notranslate nohighlight">\(N \times C\)</span>. The formula for factor B is of course the same thing, just with some subscripts shuffled around:</p>
<div class="math notranslate nohighlight">
\[
\mbox{SS}_{B} = (N \times R) \sum_{c=1}^C \left( \bar{Y}_{.c} - \bar{Y}_{..} \right)^2
\]</div>
<p>Now that we have these formulas, we can check them against the <code class="docutils literal notranslate"><span class="pre">pingouin</span></code> output from the earlier section. First, notice that we calculated all the marginal means (i.e., row marginal means <span class="math notranslate nohighlight">\(\bar{Y}_{r.}\)</span> and column marginal means <span class="math notranslate nohighlight">\(\bar{Y}_{.c}\)</span>) earlier using <code class="docutils literal notranslate"><span class="pre">.mean()</span></code>, and we also calculated the grand mean. Let’s repeat those calculations, but this time we’ll save the results to variables so that we can use them in subsequent calculations:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">drug_means</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;drug&#39;</span><span class="p">])[</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">therapy_means</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;therapy&#39;</span><span class="p">])[</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">grand_mean</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Okay, now let’s calculate the sum of squares associated with the main effect of drug. There are a total of <span class="math notranslate nohighlight">\(N=3\)</span> people in each group, and <span class="math notranslate nohighlight">\(C=2\)</span> different types of therapy. Or, to put it another way, there are <span class="math notranslate nohighlight">\(3 \times 2 = 6\)</span> people who received any particular drug. So our calculations are:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SS_drug</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="n">drug_means</span> <span class="o">-</span> <span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">round</span><span class="p">(</span><span class="n">SS_drug</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.4533
</pre></div>
</div>
</div>
</div>
<p>Not surprisingly, this is the same number that you get when you look up the SS value for the drugs factor in the ANOVA table that I presented earlier. We can repeat the same kind of calculation for the effect of therapy. Again there are <span class="math notranslate nohighlight">\(N=3\)</span> people in each group, but since there are <span class="math notranslate nohighlight">\(R=3\)</span> different drugs, this time around we note that there are <span class="math notranslate nohighlight">\(3 \times 3 = 9\)</span> people who received CBT, and an additional 9 people who received the placebo. So our calculation is now:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SS_therapy</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">((</span><span class="n">therapy_means</span> <span class="o">-</span> <span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">round</span><span class="p">(</span><span class="n">SS_therapy</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4672
</pre></div>
</div>
</div>
</div>
<p>and we are, once again, unsurprised to see that our calculations are identical to the ANOVA output.</p>
<p>So that’s how you calculate the SS values for the two main effects. These SS values are analogous to the between-group sum of squares values that we calculated when doing <a class="reference internal" href="05.03-anova.html#anova"><span class="std std-ref">one-way ANOVA</span></a>. However, it’s not a good idea to think of them as between-groups SS values anymore, just because we have two different grouping variables and it’s easy to get confused. In order to construct an <span class="math notranslate nohighlight">\(F\)</span> test, however, we also need to calculate the within-groups sum of squares. In keeping with the terminology that we used in the <a class="reference internal" href="05.04-regression.html#regression"><span class="std std-ref">regression chapter</span></a>) and the terminology that R uses when printing out the ANOVA table, I’ll start referring to the within-groups SS value as the <em>residual</em> sum of squares SS<span class="math notranslate nohighlight">\(_R\)</span>.</p>
<p>The easiest way to think about the residual SS values in this context, I think, is to think of it as the leftover variation in the outcome variable after you take into account the differences in the marginal means (i.e., after you remove SS<span class="math notranslate nohighlight">\(_A\)</span> and SS<span class="math notranslate nohighlight">\(_B\)</span>). What I mean by that is we can start by calculating the total sum of squares, which I’ll label SS<span class="math notranslate nohighlight">\(_T\)</span>. The formula for this is pretty much the same as it was for one-way ANOVA: we take the difference between each observation <span class="math notranslate nohighlight">\(Y_{rci}\)</span> and the grand mean <span class="math notranslate nohighlight">\(\bar{Y}_{..}\)</span>, square the differences, and add them all up</p>
<div class="math notranslate nohighlight">
\[
\mbox{SS}_T = \sum_{r=1}^R \sum_{c=1}^C \sum_{i=1}^N \left( Y_{rci} - \bar{Y}_{..}\right)^2
\]</div>
<p>The “triple summation” here looks more complicated than it is. In the first two summations, we’re summing across all levels of Factor A (i.e., over all possible rows <span class="math notranslate nohighlight">\(r\)</span> in our table), across all levels of Factor B (i.e., all possible columns <span class="math notranslate nohighlight">\(c\)</span>). Each <span class="math notranslate nohighlight">\(rc\)</span> combination corresponds to a single group, and each group contains <span class="math notranslate nohighlight">\(N\)</span> people: so we have to sum across all those people (i.e., all <span class="math notranslate nohighlight">\(i\)</span> values) too. In other words, all we’re doing here is summing across all observations in the data set (i.e., all possible <span class="math notranslate nohighlight">\(rci\)</span> combinations).</p>
<p>At this point, we know the total variability of the outcome variable SS<span class="math notranslate nohighlight">\(_T\)</span>, and we know how much of that variability can be attributed to Factor A (SS<span class="math notranslate nohighlight">\(_A\)</span>) and how much of it can be attributed to Factor B (SS<span class="math notranslate nohighlight">\(_B\)</span>). The residual sum of squares is thus defined to be the variability in <span class="math notranslate nohighlight">\(Y\)</span> that <em>can’t</em> be attributed to either of our two factors. In other words:</p>
<div class="math notranslate nohighlight">
\[
\mbox{SS}_R = \mbox{SS}_T - (\mbox{SS}_A + \mbox{SS}_B)
\]</div>
<p>Of course, there is a formula that you can use to calculate the residual SS directly, but I think that it makes more conceptual sense to think of it like this. The whole point of calling it a residual is that it’s the leftover variation, and the formula above makes that clear. I should also note that, in keeping with the terminology used in the regression chapter, it is commonplace to refer to <span class="math notranslate nohighlight">\(\mbox{SS}_A + \mbox{SS}_B\)</span> as the variance attributable to the “ANOVA model”, denoted SS<span class="math notranslate nohighlight">\(_M\)</span>, and so we often say that the total sum of squares is equal to the model sum of squares plus the residual sum of squares. Later on in this chapter we’ll see that this isn’t just a surface similarity: ANOVA and regression are actually the same thing under the hood.</p>
<p>In any case, it’s probably worth taking a moment to check that we can calculate SS<span class="math notranslate nohighlight">\(_R\)</span> using this formula, and verify that we do obtain the same answer that <code class="docutils literal notranslate"><span class="pre">pingouin</span></code> produces in its ANOVA table. The calculations are pretty straightforward. First we calculate the total sum of squares:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SS_tot</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">((</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">grand_mean</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">round</span><span class="p">(</span><span class="n">SS_tot</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.845
</pre></div>
</div>
</div>
</div>
<p>and then we use it to calculate the residual sum of squares:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">SS_res</span> <span class="o">=</span> <span class="n">SS_tot</span> <span class="o">-</span> <span class="p">(</span><span class="n">SS_drug</span> <span class="o">+</span> <span class="n">SS_therapy</span><span class="p">)</span>
<span class="nb">round</span><span class="p">(</span><span class="n">SS_res</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9244
</pre></div>
</div>
</div>
</div>
<p>Yet again, we get the same answer.</p>
</section>
<section id="what-are-our-degrees-of-freedom">
<h3><span class="section-number">17.1.3. </span>What are our degrees of freedom?<a class="headerlink" href="#what-are-our-degrees-of-freedom" title="Permalink to this heading">#</a></h3>
<p>The degrees of freedom are calculated in much the same way as for one-way ANOVA. For any given factor, the degrees of freedom is equal to the number of levels minus 1 (i.e., <span class="math notranslate nohighlight">\(R-1\)</span> for the row variable, Factor A, and <span class="math notranslate nohighlight">\(C-1\)</span> for the column variable, Factor B). So, for the <code class="docutils literal notranslate"><span class="pre">drugs</span></code> factor we obtain <span class="math notranslate nohighlight">\(df = 2\)</span>, and for the <code class="docutils literal notranslate"><span class="pre">therapy</span></code> factor we obtain <span class="math notranslate nohighlight">\(df=1\)</span>. Later on on, when we discuss the interpretation of <span class="xref myst">ANOVA as a regression model</span>), I’ll give a clearer statement of how we arrive at this number, but for the moment we can use the simple definition of degrees of freedom, namely that the degrees of freedom equals the number of quantities that are observed, minus the number of constraints. So, for the <code class="docutils literal notranslate"><span class="pre">drugs</span></code> factor, we observe 3 separate group means, but these are constrained by 1 grand mean; and therefore the degrees of freedom is 2. For the residuals, the logic is similar, but not quite the same. The total number of observations in our experiment is 18. The constraints correspond to the 1 grand mean, the 2 additional group means that the <code class="docutils literal notranslate"><span class="pre">drug</span></code> factor introduces, and the 1 additional group mean that the the <code class="docutils literal notranslate"><span class="pre">therapy</span></code> factor introduces, and so our degrees of freedom is 14. As a formula, this is <span class="math notranslate nohighlight">\(N-1 -(R-1)-(C-1)\)</span>, which simplifies to <span class="math notranslate nohighlight">\(N-R-C+1\)</span>.</p>
</section>
<section id="factorial-anova-versus-one-way-anovas">
<h3><span class="section-number">17.1.4. </span>Factorial ANOVA versus one-way ANOVAs<a class="headerlink" href="#factorial-anova-versus-one-way-anovas" title="Permalink to this heading">#</a></h3>
<p>Now that we’ve seen <em>how</em> a factorial ANOVA works, it’s worth taking a moment to compare it to the results of the one way analyses, because this will give us a really good sense of <em>why</em> it’s a good idea to run the factorial ANOVA. In the <a class="reference internal" href="05.03-anova.html#anova"><span class="std std-ref">chapter on 1-way ANOVA</span></a>, I ran a one-way ANOVA that looked to see if there are any differences between drugs, and a second one-way ANOVA to see if there were any differences between therapies. As we saw in <a class="reference internal" href="#factanovahyp"><span class="std std-ref">previously</span></a>, the null and alternative hypotheses tested by the one-way ANOVAs are in fact identical to the hypotheses tested by the factorial ANOVA. Looking even more carefully at the ANOVA tables, we can see that the sum of squares associated with the factors are identical in the two different analyses (3.45 for <code class="docutils literal notranslate"><span class="pre">drug</span></code> and 0.92 for <code class="docutils literal notranslate"><span class="pre">therapy</span></code>), as are the degrees of freedom (2 for <code class="docutils literal notranslate"><span class="pre">drug</span></code>, 1 for <code class="docutils literal notranslate"><span class="pre">therapy</span></code>). But they don’t give the same answers! Most notably, when we ran the <a class="reference internal" href="05.03-anova.html#anovaandt"><span class="std std-ref">one-way ANOVA for <code class="docutils literal notranslate"><span class="pre">therapy</span></code></span></a> we didn’t find a significant effect (the <span class="math notranslate nohighlight">\(p\)</span>-value was 0.21). However, when we look at the main effect of <code class="docutils literal notranslate"><span class="pre">therapy</span></code> within the context of the two-way ANOVA, we do get a significant effect (<span class="math notranslate nohighlight">\(p=.019\)</span>). The two analyses are clearly not the same.</p>
<p>Why does that happen? The answer lies in understanding how the <em>residuals</em> are calculated. Recall that the whole idea behind an <span class="math notranslate nohighlight">\(F\)</span>-test is to compare the variability that can be attributed to a particular factor with the variability that cannot be accounted for (the residuals). If you run a one-way ANOVA for <code class="docutils literal notranslate"><span class="pre">therapy</span></code>, and therefore ignore the effect of <code class="docutils literal notranslate"><span class="pre">drug</span></code>, the ANOVA will end up dumping all of the drug-induced variability into the residuals! This has the effect of making the data look more noisy than they really are, and the effect of <code class="docutils literal notranslate"><span class="pre">therapy</span></code> which is correctly found to be significant in the two-way ANOVA now becomes non-significant. If we ignore something that actually matters (e.g., <code class="docutils literal notranslate"><span class="pre">drug</span></code>) when trying to assess the contribution of something else (e.g., <code class="docutils literal notranslate"><span class="pre">therapy</span></code>) then our analysis will be distorted. Of course, it’s perfectly okay to ignore variables that are genuinely irrelevant to the phenomenon of interest: if we had recorded the colour of the walls, and that turned out to be non-significant in a three-way ANOVA (i.e. <code class="docutils literal notranslate"><span class="pre">pg.anova(dv='mood_gain',</span> <span class="pre">between=['drug',</span> <span class="pre">'therapy',</span> <span class="pre">'wall_color']</span></code>), it would be perfectly okay to disregard it and just report the simpler two-way ANOVA that doesn’t include this irrelevant factor. What you shouldn’t do is drop variables that actually make a difference!</p>
</section>
<section id="what-kinds-of-outcomes-does-this-analysis-capture">
<h3><span class="section-number">17.1.5. </span>What kinds of outcomes does this analysis capture?<a class="headerlink" href="#what-kinds-of-outcomes-does-this-analysis-capture" title="Permalink to this heading">#</a></h3>
<p>The ANOVA model that we’ve been talking about so far covers a range of different patterns that we might observe in our data. For instance, in a two-way ANOVA design, there are four possibilities: (a) only Factor A matters, (b) only Factor B matters, (c) both A and B matter, and (d) neither A nor B matters. An example of each of these four possibilities is plotted in <a class="reference internal" href="#fig-anovas-sans-interaction"><span class="std std-numref">Fig. 17.1</span></a>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Level 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Level 2&#39;</span><span class="p">]</span>
<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Factor B, Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Factor B, Level 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Factor B, Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Factor B, Level 2&#39;</span><span class="p">]</span>
<span class="n">panel1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mf">2.2</span><span class="p">]</span>
<span class="n">panel2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">,</span> <span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.9</span><span class="p">]</span>
<span class="n">panel3</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.6</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">]</span>
<span class="n">panel4</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">]</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Factor&#39;</span><span class="p">:</span> <span class="n">factors</span><span class="p">,</span>
                   <span class="s1">&#39;Factor A&#39;</span><span class="p">:</span> <span class="n">levels</span><span class="p">,</span>
                   <span class="s1">&#39;Panel 1&#39;</span><span class="p">:</span> <span class="n">panel1</span><span class="p">,</span>
                   <span class="s1">&#39;Panel 2&#39;</span><span class="p">:</span> <span class="n">panel2</span><span class="p">,</span>
                   <span class="s1">&#39;Panel 3&#39;</span><span class="p">:</span> <span class="n">panel3</span><span class="p">,</span>
                   <span class="s1">&#39;Panel 4&#39;</span><span class="p">:</span> <span class="n">panel4</span><span class="p">})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>


<span class="n">p1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;Factor A&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Panel 1&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span> <span class="s1">&#39;Factor&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;Factor A&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Panel 2&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span> <span class="s1">&#39;Factor&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;Factor A&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Panel 3&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span> <span class="s1">&#39;Factor&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">p4</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;Factor A&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Panel 4&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span> <span class="s1">&#39;Factor&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">]</span>
<span class="n">panelID</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Only Factor A has an effect&#39;</span><span class="p">,</span> <span class="s1">&#39;Only Factor B has an effect&#39;</span><span class="p">,</span> 
          <span class="s1">&#39;Both A and B have an effect&#39;</span><span class="p">,</span> <span class="s1">&#39;Neither A nor B has an effect&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ps</span><span class="p">):</span>
    <span class="n">p</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">titles</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">panelID</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="n">p1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">p3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Factor A&#39;</span><span class="p">)</span>
<span class="n">p4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Factor A&#39;</span><span class="p">)</span>

<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Factor B, Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Factor B, Level 2&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="c1"># Plot figure in book, with caption</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;anovas-sans-interaction-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<figure class="align-default" id="fig-anovas-sans-interaction" style="width: 600px">
<img alt="_images/8fc757cd7cb9a10f2e283e930de4ced7c4c25edb3489af7bdcbf81d4ed423bbd.png" src="_images/8fc757cd7cb9a10f2e283e930de4ced7c4c25edb3489af7bdcbf81d4ed423bbd.png" />
<figcaption>
<p><span class="caption-number">Fig. 17.1 </span><span class="caption-text">The four different outcomes for a 2 x 2 ANOVA when no interactions are present. In Panel A we see a main effect of Factor A, and no effect of Factor B. Panel B shows a main effect of Factor B but no effect of Factor A. Panel C shows main effects of both Factor A and Factor B. Finally, Panel D shows no effect of either factor.</span><a class="headerlink" href="#fig-anovas-sans-interaction" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
<section id="factorial-anova-2-balanced-designs-interactions-allowed">
<span id="interactions"></span><h2><span class="section-number">17.2. </span>Factorial ANOVA 2: balanced designs, interactions allowed<a class="headerlink" href="#factorial-anova-2-balanced-designs-interactions-allowed" title="Permalink to this heading">#</a></h2>
<p>The four patterns of data shown in <code class="xref std std-numref docutils literal notranslate"><span class="pre">anovas-sans-interaction-fig</span></code> are all quite realistic: there are a great many data sets that produce exactly those patterns. However, they are not the whole story, and the ANOVA model that we have been talking about up to this point is not sufficient to fully account for a table of group means. Why not? Well, so far we have the ability to talk about the idea that drugs can influence mood, and therapy can influence mood, but no way of talking about the possibility of an <strong><em>interaction</em></strong> between the two. An interaction between A and B is said to occur whenever the effect of Factor A is <em>different</em>, depending on which level of Factor B we’re talking about. Several examples of an interaction effect with the context of a 2 x 2 ANOVA are shown in <a class="reference internal" href="#fig-anovas-avec-interaction"><span class="std std-numref">Fig. 17.2</span></a>. To give a more concrete example, suppose that the operation of Anxifree and Joyzepam is governed quite different physiological mechanisms, and one consequence of this is that while Joyzepam has more or less the same effect on mood regardless of whether one is in therapy, Anxifree is actually much more effective when administered in conjunction with CBT. The ANOVA that we developed in the previous section does not capture this idea. To get some idea of whether an interaction is actually happening here, it helps to plot the various group means.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>

<span class="n">levels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Level 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Level 2&#39;</span><span class="p">]</span>
<span class="n">factors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Factor B, Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Factor B, Level 2&#39;</span><span class="p">,</span> <span class="s1">&#39;Factor B, Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Factor B, Level 2&#39;</span><span class="p">]</span>
<span class="n">panel1</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span>
<span class="n">panel2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">panel3</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.4</span><span class="p">]</span>
<span class="n">panel4</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1.4</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">]</span>

<span class="n">d</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;Factor&#39;</span><span class="p">:</span> <span class="n">factors</span><span class="p">,</span>
                   <span class="s1">&#39;Factor A&#39;</span><span class="p">:</span> <span class="n">levels</span><span class="p">,</span>
                   <span class="s1">&#39;Panel 1&#39;</span><span class="p">:</span> <span class="n">panel1</span><span class="p">,</span>
                   <span class="s1">&#39;Panel 2&#39;</span><span class="p">:</span> <span class="n">panel2</span><span class="p">,</span>
                   <span class="s1">&#39;Panel 3&#39;</span><span class="p">:</span> <span class="n">panel3</span><span class="p">,</span>
                   <span class="s1">&#39;Panel 4&#39;</span><span class="p">:</span> <span class="n">panel4</span><span class="p">})</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>


<span class="n">p1</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;Factor A&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Panel 1&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span> <span class="s1">&#39;Factor&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">p2</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;Factor A&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Panel 2&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span> <span class="s1">&#39;Factor&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
<span class="n">p3</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;Factor A&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Panel 3&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span> <span class="s1">&#39;Factor&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
<span class="n">p4</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">d</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="s1">&#39;Factor A&#39;</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="s1">&#39;Panel 4&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span> <span class="s1">&#39;Factor&#39;</span><span class="p">,</span> <span class="n">errorbar</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

<span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">p4</span><span class="p">]</span>
<span class="n">panelID</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">]</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Crossover interaction&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect for one level of Factor A&#39;</span><span class="p">,</span> 
          <span class="s1">&#39;One cell is different&#39;</span><span class="p">,</span> <span class="s1">&#39;Effect for one level of Factor B&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ps</span><span class="p">):</span>
    <span class="n">p</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
    <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">titles</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">,</span> <span class="n">panelID</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">transAxes</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>

<span class="n">p1</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">p2</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">p3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Factor A&#39;</span><span class="p">)</span>
<span class="n">p4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Factor A&#39;</span><span class="p">)</span>

<span class="n">handles</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;Factor B, Level 1&#39;</span><span class="p">,</span> <span class="s1">&#39;Factor B, Level 2&#39;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>


<span class="c1"># Plot figure in book, with caption</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;anovas-avec-interaction-fig&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<figure class="align-default" id="fig-anovas-avec-interaction" style="width: 600px">
<img alt="_images/75c83a691c2d04154f7eb4e81f8093ebe13b0ec5932ddce48ea98be004921005.png" src="_images/75c83a691c2d04154f7eb4e81f8093ebe13b0ec5932ddce48ea98be004921005.png" />
<figcaption>
<p><span class="caption-number">Fig. 17.2 </span><span class="caption-text">Qualitatively different interactions for a 2 x 2 ANOVA</span><a class="headerlink" href="#fig-anovas-avec-interaction" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p>To give a more concrete example, suppose that the operation of Anxifree and Joyzepam is governed quite different physiological mechanisms, and one consequence of this is that while Joyzepam has more or less the same effect on mood regardless of whether one is in therapy, Anxifree is actually much more effective when administered in conjunction with CBT. The ANOVA that we developed in the previous section does not capture this idea. To get some idea of whether an interaction is actually happening here, it helps to plot the various group means. We can do this easily with <code class="docutils literal notranslate"><span class="pre">seaborn</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sns</span><span class="o">.</span><span class="n">pointplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;drug&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;therapy&#39;</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b3ad66506061f50d80c39ef4063b2cac35789f94d8a17eac5cedbf8cd0d591a6.png" src="_images/b3ad66506061f50d80c39ef4063b2cac35789f94d8a17eac5cedbf8cd0d591a6.png" />
</div>
</div>
<p>Our main concern relates to the fact that the two lines aren’t parallel. The effect of CBT (difference between solid line and dotted line) when the drug is Joyzepam (right side) appears to be near zero, even smaller than the effect of CBT when a placebo is used (left side). However, when Anxifree is administered, the effect of CBT is larger than the placebo (middle). Is this effect real, or is this just random variation due to chance? Our original ANOVA cannot answer this question, because we make no allowances for the idea that interactions even exist! In this section, we’ll fix this problem.</p>
<section id="what-exactly-is-an-interaction-effect">
<h3><span class="section-number">17.2.1. </span>What exactly <em>is</em> an interaction effect?<a class="headerlink" href="#what-exactly-is-an-interaction-effect" title="Permalink to this heading">#</a></h3>
<p>The key idea that we’re going to introduce in this section is that of an interaction effect. <code class="docutils literal notranslate"><span class="pre">pingouin</span></code> has already been calculating the for us, but to keep things simple, I have just ignored them. Now the time has come to look at that <em>other</em> line in the ANOVA table, the one that about “drug*therapy”.</p>
<p>Intuitively, the idea behind an interaction effect is fairly simple: it just means that the effect of Factor A is different, depending on which level of Factor B we’re talking about. But what does that actually mean in terms of our data? <a class="reference internal" href="#fig-anovas-avec-interaction"><span class="std std-numref">Fig. 17.2</span></a> depicts several different patterns that, although quite different to each other, would all count as an interaction effect. So it’s not entirely straightforward to translate this qualitative idea into something mathematical that a statistician can work with. As a consequence, the way that the idea of an interaction effect is formalised in terms of null and alternative hypotheses is slightly difficult, and I’m guessing that a lot of readers of this book probably won’t be all that interested. Even so, I’ll try to give the basic idea here.</p>
<p>To start with, we need to be a little more explicit about our main effects. Consider the main effect of Factor A (<code class="docutils literal notranslate"><span class="pre">drug</span></code> in our running example). We originally formulated this in terms of the null hypothesis that the two marginal means <span class="math notranslate nohighlight">\(\mu_{r.}\)</span> are all equal to each other. Obviously, if all of these are equal to each other, then they must also be equal to the grand mean <span class="math notranslate nohighlight">\(\mu_{..}\)</span> as well, right? So what we can do is define the <em>effect</em> of Factor A at level <span class="math notranslate nohighlight">\(r\)</span> to be equal to the difference between the marginal mean <span class="math notranslate nohighlight">\(\mu_{r.}\)</span> and the grand mean <span class="math notranslate nohighlight">\(\mu_{..}\)</span>.</p>
<p>Let’s denote this effect by <span class="math notranslate nohighlight">\(\alpha_r\)</span>, and note that</p>
<div class="math notranslate nohighlight">
\[
\alpha_r  = \mu_{r.} - \mu_{..} 
\]</div>
<p>Now, by definition all of the <span class="math notranslate nohighlight">\(\alpha_r\)</span> values must sum to zero, for the same reason that the average of the marginal means <span class="math notranslate nohighlight">\(\mu_{r.}\)</span> must be the grand mean <span class="math notranslate nohighlight">\(\mu_{..}\)</span>. We can similarly define the effect of Factor B at level <span class="math notranslate nohighlight">\(i\)</span> to be the difference between the column marginal mean <span class="math notranslate nohighlight">\(\mu_{.c}\)</span> and the grand mean <span class="math notranslate nohighlight">\(\mu_{..}\)</span></p>
<div class="math notranslate nohighlight">
\[
\beta_c = \mu_{.c} - \mu_{..}
\]</div>
<p>and once again, these <span class="math notranslate nohighlight">\(\beta_c\)</span> values must sum to zero. The reason that statisticians sometimes like to talk about the main effects in terms of these <span class="math notranslate nohighlight">\(\alpha_r\)</span> and <span class="math notranslate nohighlight">\(\beta_c\)</span> values is that it allows them to be precise about what it means to say that there is no interaction effect. If there is no interaction at all, then these <span class="math notranslate nohighlight">\(\alpha_r\)</span> and <span class="math notranslate nohighlight">\(\beta_c\)</span> values will perfectly describe the group means <span class="math notranslate nohighlight">\(\mu_{rc}\)</span>. Specifically, it means that</p>
<div class="math notranslate nohighlight">
\[
\mu_{rc} = \mu_{..} + \alpha_r + \beta_c 
\]</div>
<p>That is, there’s nothing <em>special</em> about the group means that you couldn’t predict perfectly by knowing all the marginal means. And that’s our null hypothesis, right there. The alternative hypothesis is that</p>
<div class="math notranslate nohighlight">
\[
\mu_{rc} \neq \mu_{..} + \alpha_r + \beta_c 
\]</div>
<p>for at least one group <span class="math notranslate nohighlight">\(rc\)</span> in our table. However, statisticians often like to write this slightly differently. They’ll usually define the specific interaction associated with group <span class="math notranslate nohighlight">\(rc\)</span> to be some number, awkwardly referred to as <span class="math notranslate nohighlight">\((\alpha\beta)_{rc}\)</span>, and then they will say that the alternative hypothesis is that</p>
<div class="math notranslate nohighlight">
\[
\mu_{rc} = \mu_{..} + \alpha_r + \beta_c + (\alpha\beta)_{rc}
\]</div>
<p>where <span class="math notranslate nohighlight">\((\alpha\beta)_{rc}\)</span> is non-zero for at least one group. This notation is kind of ugly to look at, but it is handy as we’ll see in the next section when discussing how to calculate the sum of squares.</p>
</section>
<section id="calculating-sums-of-squares-for-the-interaction">
<h3><span class="section-number">17.2.2. </span>Calculating sums of squares for the interaction<a class="headerlink" href="#calculating-sums-of-squares-for-the-interaction" title="Permalink to this heading">#</a></h3>
<p>How should we calculate the sum of squares for the interaction terms, SS<span class="math notranslate nohighlight">\(_{A:B}\)</span>?</p>
<p>Well, first off, it helps to notice how the previous section defined the interaction effect in terms of the extent to which the actual group means differ from what you’d expect by just looking at the marginal means. Of course, all of those formulas refer to population parameters rather than sample statistics, so we don’t actually know what they are. However, we can estimate them by using sample means in place of population means. So for Factor A, a good way to estimate the main effect at level <span class="math notranslate nohighlight">\(r\)</span> as the difference between the <em>sample</em> marginal mean <span class="math notranslate nohighlight">\(\bar{Y}_{rc}\)</span> and the sample grand mean <span class="math notranslate nohighlight">\(\bar{Y}_{..}\)</span>. That is, we would use this as our estimate of the effect:</p>
<div class="math notranslate nohighlight">
\[
\hat{\alpha}_r = \bar{Y}_{r.} - \bar{Y}_{..}
\]</div>
<p>Similarly, our estimate of the main effect of Factor B at level <span class="math notranslate nohighlight">\(c\)</span> can be defined as follows:</p>
<div class="math notranslate nohighlight">
\[
\hat{\beta}_c = \bar{Y}_{.c} - \bar{Y}_{..}
\]</div>
<p>Now, if you go back to the formulas that I used to describe the SS values for the two main effects, you’ll notice that these effect terms are exactly the quantities that we were squaring and summing! So what’s the analog of this for interaction terms? The answer to this can be found by first rearranging the formula for the group means <span class="math notranslate nohighlight">\(\mu_{rc}\)</span> under the alternative hypothesis, so that we get this:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
(\alpha \beta)_{rc} &amp;= \mu_{rc} - \mu_{..} - \alpha_r - \beta_c \\
                &amp;= \mu_{rc} - \mu_{..} - (\mu_{r.} - \mu_{..}) - (\mu_{.c} - \mu_{..}) \\
                &amp; =  \mu_{rc} - \mu_{r.} - \mu_{.c} + \mu_{..}
\end{align}
\end{split}\]</div>
<p>So, once again, if we substitute our sample statistics in place of the population means, we get the following as our estimate of the interaction effect for group <span class="math notranslate nohighlight">\(rc\)</span>, which is</p>
<div class="math notranslate nohighlight">
\[
\hat{(\alpha\beta)}_{rc} = \bar{Y}_{rc} - \bar{Y}_{r.} - \bar{Y}_{.c} + \bar{Y}_{..}
\]</div>
<p>Now all we have to do is sum all of these estimates across all <span class="math notranslate nohighlight">\(R\)</span> levels of Factor A and all <span class="math notranslate nohighlight">\(C\)</span> levels of Factor B, and we obtain the following formula for the sum of squares associated with the interaction as a whole:</p>
<div class="math notranslate nohighlight">
\[
\mbox{SS}_{A:B} = N \sum_{r=1}^R \sum_{c=1}^C \left( \bar{Y}_{rc} - \bar{Y}_{r.} - \bar{Y}_{.c} + \bar{Y}_{..} \right)^2
\]</div>
<p>where, we multiply by <span class="math notranslate nohighlight">\(N\)</span> because there are <span class="math notranslate nohighlight">\(N\)</span> observations in each of the groups, and we want our SS values to reflect the variation among <em>observations</em> accounted for by the interaction, not the variation among groups.</p>
<p>Now that we have a formula for calculating SS<span class="math notranslate nohighlight">\(_{A:B}\)</span>, it’s important to recognise that the interaction term is part of the model (of course), so the total sum of squares associated with the model, SS<span class="math notranslate nohighlight">\(_M\)</span> is now equal to the sum of the three relevant SS values, <span class="math notranslate nohighlight">\(\mbox{SS}_A + \mbox{SS}_B + \mbox{SS}_{A:B}\)</span>. The residual sum of squares <span class="math notranslate nohighlight">\(\mbox{SS}_R\)</span> is still defined as the leftover variation, namely <span class="math notranslate nohighlight">\(\mbox{SS}_T - \mbox{SS}_M\)</span>, but now that we have the interaction term this becomes</p>
<div class="math notranslate nohighlight">
\[
\mbox{SS}_R = \mbox{SS}_T - (\mbox{SS}_A + \mbox{SS}_B + \mbox{SS}_{A:B})
\]</div>
<p>As a consequence, the residual sum of squares SS<span class="math notranslate nohighlight">\(_R\)</span> will be smaller than in our original ANOVA that didn’t include interactions.</p>
</section>
<section id="degrees-of-freedom-for-the-interaction">
<h3><span class="section-number">17.2.3. </span>Degrees of freedom for the interaction<a class="headerlink" href="#degrees-of-freedom-for-the-interaction" title="Permalink to this heading">#</a></h3>
<p>Calculating the degrees of freedom for the interaction is, once again, slightly trickier than the corresponding calculation for the main effects. To start with, let’s think about the ANOVA model as a whole. Once we include interaction effects in the model, we’re allowing every single group to have a unique mean, <span class="math notranslate nohighlight">\(\mu_{rc}\)</span>. For an <span class="math notranslate nohighlight">\(R \times C\)</span> factorial ANOVA, this means that there are <span class="math notranslate nohighlight">\(R \times C\)</span> quantities of interest in the model, and only the one constraint: all of the group means need to average out to the grand mean. So the model as a whole needs to have <span class="math notranslate nohighlight">\((R\times C) - 1\)</span> degrees of freedom. But the main effect of Factor A has <span class="math notranslate nohighlight">\(R-1\)</span> degrees of freedom, and the main effect of Factor B has <span class="math notranslate nohighlight">\(C-1\)</span> degrees of freedom. Which means that the degrees of freedom associated with the interaction is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
df_{A:B} &amp;= (R\times C - 1) - (R - 1) - (C -1 ) \\
        &amp;= RC - R - C + 1 \\
        &amp;= (R-1)(C-1)
\end{align}
\end{split}\]</div>
<p>which is just the product of the degrees of freedom associated with the row factor and the column factor.</p>
<p>What about the residual degrees of freedom? Because we’ve added interaction terms, which absorb some degrees of freedom, there are fewer residual degrees of freedom left over. Specifically, note that if the model with interaction has a total of <span class="math notranslate nohighlight">\((R\times C) - 1\)</span>, and there are <span class="math notranslate nohighlight">\(N\)</span> observations in your data set that are constrained to satisfy 1 grand mean, your residual degrees of freedom now become <span class="math notranslate nohighlight">\(N-(R \times C)-1+1\)</span>, or just <span class="math notranslate nohighlight">\(N-(R \times C)\)</span>.</p>
</section>
<section id="interpreting-the-results">
<h3><span class="section-number">17.2.4. </span>Interpreting the results<a class="headerlink" href="#interpreting-the-results" title="Permalink to this heading">#</a></h3>
<p>Now we are in a position to understand all the rows in the ANOVA table that we saw earlier. Even if you skimmed lightly over the math in the previous section (and you would be forgiven if you did), hopefully you will now have some intuition for the differences between main effects and interaction effects. But what does it all mean, in the end?</p>
<p>Let’s quickly remind ourselves of the results of our factorial ANOVA:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model2</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">anova</span><span class="p">(</span><span class="n">dv</span><span class="o">=</span><span class="s1">&#39;mood_gain&#39;</span><span class="p">,</span> <span class="n">between</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;drug&#39;</span><span class="p">,</span> <span class="s1">&#39;therapy&#39;</span><span class="p">],</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">detailed</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">round</span><span class="p">(</span><span class="n">model2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Source</th>
      <th>SS</th>
      <th>DF</th>
      <th>MS</th>
      <th>F</th>
      <th>p-unc</th>
      <th>np2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>drug</td>
      <td>3.453</td>
      <td>2</td>
      <td>1.727</td>
      <td>31.714</td>
      <td>0.000</td>
      <td>0.841</td>
    </tr>
    <tr>
      <th>1</th>
      <td>therapy</td>
      <td>0.467</td>
      <td>1</td>
      <td>0.467</td>
      <td>8.582</td>
      <td>0.013</td>
      <td>0.417</td>
    </tr>
    <tr>
      <th>2</th>
      <td>drug * therapy</td>
      <td>0.271</td>
      <td>2</td>
      <td>0.136</td>
      <td>2.490</td>
      <td>0.125</td>
      <td>0.293</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Residual</td>
      <td>0.653</td>
      <td>12</td>
      <td>0.054</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can now see that while we do have a significant main effect of drug (<span class="math notranslate nohighlight">\(F_{2,12} = 31.7, p &lt;.001\)</span>) and therapy type (<span class="math notranslate nohighlight">\(F_{1,12} = 8.6, p=.013\)</span>), there is no significant interaction between the two (<span class="math notranslate nohighlight">\(F_{2,12} = 2.5, p = 0.125\)</span>).</p>
<p>There’s a couple of very important things to consider when interpreting the results of factorial ANOVA. Firstly, there’s the same issue that we had with one-way ANOVA, which is that if you obtain a significant main effect of (say) <code class="docutils literal notranslate"><span class="pre">drug</span></code>, it doesn’t tell you anything about which drugs are different to one another. To find that out, you need to run additional analyses. We’ll talk about some analyses that you can run in the sections on <span class="xref myst">contrasts</span> and <span class="xref myst">post-hoc tests</span>. The same is true for interaction effects: knowing that there’s a significant interaction doesn’t tell you anything about what kind of interaction exists. Again, you’ll need to run additional analyses.</p>
<p>Secondly, there’s a very peculiar interpretation issue that arises when you obtain a significant interaction effect but no corresponding main effect. This happens sometimes. For instance, in the crossover interaction shown in <a class="reference internal" href="#fig-anovas-avec-interaction"><span class="std std-numref">Fig. 17.2</span></a>), this is exactly what you’d find: in this case, neither of the main effects would be significant, but the interaction effect would be. This is a difficult situation to interpret, and people often get a bit confused about it. The general advice that statisticians like to give in this situation is that you shouldn’t pay much attention to the main effects when an interaction is present. The reason they say this is that, although the tests of the main effects are perfectly valid from a mathematical point of view, when there is a significant interaction effect, the main effects rarely test interesting hypotheses. <a class="reference internal" href="#factanovahyp"><span class="std std-ref">Recall</span></a> that the null hypothesis for a main effect is that the <em>marginal means</em> are equal to each other, and that a marginal mean is formed by averaging across several different groups. But if you have a significant interaction effect, then you <em>know</em> that the groups that comprise the marginal mean aren’t homogeneous, so it’s not really obvious why you would even care about those marginal means.</p>
<p>Here’s what I mean. Again, let’s stick with a clinical example. Suppose that we had a <span class="math notranslate nohighlight">\(2 \times 2\)</span> design comparing two different treatments for phobias (e.g., systematic desensitisation vs flooding), and two different anxiety reducing drugs (e.g., Anxifree vs Joyzepam). Now suppose what we found was that Anxifree had no effect when desensitisation was the treatment, and Joyzepam had no effect when flooding was the treatment. But both were pretty effective for the other treatment. This is a classic crossover interaction, and what we’d find when running the ANOVA is that there is no main effect of drug, but a significant interaction. Now, what does it actually <em>mean</em> to say that there’s no main effect? Wel, it means that, if we average over the two different psychological treatments, then the <em>average</em> effect of Anxifree and Joyzepam is the same. But why would anyone care about that? When treating someone for phobias, it is never the case that a person can be treated using an “average” of flooding and desensitisation: that doesn’t make a lot of sense. You either get one or the other. For one treatment, one drug is effective; and for the other treatment, the other drug is effective. The interaction is the important thing; the main effect is kind of irrelevant.</p>
<p>This sort of thing happens a lot: the main effect are tests of marginal means, and when an interaction is present we often find ourselves not being terribly interested in marginal means, because they imply averaging over things that the interaction tells us shouldn’t be averaged! Of course, it’s not always the case that a main effect is meaningless when an interaction is present. Often you can get a big main effect and a very small interaction, in which case you can still say things like “drug A is generally more effective than drug B” (because there was a big effect of drug), but you’d need to modify it a bit by adding that “the difference in effectiveness was different for different psychological treatments”. In any case, the main point here is that whenever you get a significant interaction you should stop and <em>think</em> about what the main effect actually means in this context. Don’t automatically assume that the main effect is interesting.</p>
<hr class="footnotes docutils" />
<aside class="footnote brackets" id="notesubscript" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id1">1</a><span class="fn-bracket">]</span></span>
<p>The nice thing about the subscript notation is that generalises nicely: if our experiment had involved a third factor, then we could just add a third subscript. In principle, the notation extends to as many factors as you might care to include, but in this book we’ll rarely consider analyses involving more than two factors, and never more than three.</p>
</aside>
<aside class="footnote brackets" id="notemarginalising" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Technically, marginalising isn’t quite identical to a regular mean: it’s a weighted average, where you take into account the frequency of the different events that you’re averaging over. However, in a balanced design, all of our cell frequencies are equal by definition, so the two are equivalent. We’ll discuss unbalanced designs later, and when we do so you’ll see that all of our calculations become a real headache. But let’s ignore this for now.</p>
</aside>
<aside class="footnote brackets" id="translation" role="note">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>English translation: “least tedious”.</p>
</aside>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="05.04-regression.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">16. </span>Linear regression</p>
      </div>
    </a>
    <a class="right-next"
       href="06.01-bayes.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">18. </span>Bayesian Statistics</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factorial-anova-1-balanced-designs-no-interactions">17.1. Factorial ANOVA 1: balanced designs, no interactions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-hypotheses-are-we-testing">17.1.1. What hypotheses are we testing?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-analysis-in-python">17.1.2. Running the analysis in Python</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-are-our-degrees-of-freedom">17.1.3. What are our degrees of freedom?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#factorial-anova-versus-one-way-anovas">17.1.4. Factorial ANOVA versus one-way ANOVAs</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-kinds-of-outcomes-does-this-analysis-capture">17.1.5. What kinds of outcomes does this analysis capture?</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#factorial-anova-2-balanced-designs-interactions-allowed">17.2. Factorial ANOVA 2: balanced designs, interactions allowed</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#what-exactly-is-an-interaction-effect">17.2.1. What exactly <em>is</em> an interaction effect?</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-sums-of-squares-for-the-interaction">17.2.2. Calculating sums of squares for the interaction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#degrees-of-freedom-for-the-interaction">17.2.3. Degrees of freedom for the interaction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpreting-the-results">17.2.4. Interpreting the results</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Danielle Navarro and Ethan Weed
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2021.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>